<%-- 
    Document   : report30days
    Created on : May 30, 2019, 9:15:14 PM
    Author     : victor
--%>

<%@page import="com.itextpdf.text.*"%>
<%@page import="com.itextpdf.text.pdf.*"%>
<%@page import="com.itextpdf.text.Document"%>
<%@page import="java.sql.*"%>
<%@page import="java.sql.SQLException"%>
<%@page import="java.sql.DriverManager"%>
<%@page import="dataAccessObjects.DBConnection"%>
<%@page import="Models.Records"%>
<%@page contentType="text/html" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>JSP Page</title>
    </head>
    <body>
       
        
        <%
              int femDonors =0;
    int maleDonors =0;
    int totalDonors = 0;
    int femAdultDonors = 0;
    int maleAdultDonors = 0;
    Records record = new Records();
    DBConnection db = new DBConnection();
    db.thirtyDaysRecord(record);
     Connection connection = null;
            PreparedStatement pstatement;
            ResultSet resultSet;
            if (connection == null || connection.isClosed()) {
                try {
                    Class.forName("com.mysql.jdbc.Driver");
                    connection = DriverManager.getConnection("jdbc:mysql://localhost/BloodBank", "root", "gachau");
                } catch (ClassNotFoundException e) {
                    throw new SQLException(e);
                }
            }

            String str = "pdf";
            Document document = new Document();
            
            //  Document document = new Document();
                if (str.equals("pdf")) {
                    response.setContentType("application/pdf");
                    PdfWriter.getInstance(document, response.getOutputStream());
                }

                 document.open();

                /* new paragraph instance initialized and add function write in pdf file*/
                document.add(new Paragraph("----------------CBBank SYSTEM REPORT FOR THE MONTH OF: June"
                        + "-----------------------------------\n\n"));
                document.add(new Paragraph("                              REPORT GENERATED BY: County Blood Bank  \n\n"));
                document.add(new Paragraph("-----------------------------------------------------------------"
                        + "----------------------------------------------------------------"));
                document.add(new Paragraph("                 NEWLY REGISTERED DONORS   "));
                
                 int femStudent =0, maleStudent=0;
                 
                 String sql = "select count(gender) as total from STUDENTDONORS where month(now()) and gender='male'";
                 pstatement = connection.prepareStatement(sql);
                 resultSet = pstatement.executeQuery();
                 while(resultSet.next()){
                          maleStudent = resultSet.getInt(1);
                    
                 }
                 String sql1 = "select count(gender) as total from STUDENTDONORS where month(now()) and gender='female'";
                 pstatement = connection.prepareStatement(sql1);
                 resultSet = pstatement.executeQuery();
                 while(resultSet.next()){
                     femStudent = resultSet.getInt(1);
                    
                 }
                   int totalStudent = femStudent + maleStudent;
                   //New Donors Tabble
                 PdfPTable donorTable  = new PdfPTable(3);
                 donorTable.setWidthPercentage(100);
                                    donorTable.addCell("");
                 donorTable.addCell("ADULTS");
                  donorTable.addCell("STUDENTS");

                   donorTable.addCell("MALE");
                    donorTable.addCell(""+record.getMaleDonors());
                    donorTable.addCell(""+ maleStudent);
                   donorTable.addCell("FEMALE");
                   donorTable.addCell(""+record.getFemDonors());
                                      donorTable.addCell(""+femStudent);
                               
                    donorTable.addCell("TOTAL");
                                       donorTable.addCell(""+record.getTotalDonors());
                                                          donorTable.addCell(""+totalStudent);
                 
                    document.add(donorTable);

                 
                    
                    // All Bags Donated Table
                 String sql2 = "select count(bloodgroup) as total from bloodbags where bloodgroup ='A' and bloodtype='+ve' and month(now()) and bloodstatus='yes' ";
                  pstatement = connection.prepareStatement(sql2);
                 resultSet = pstatement.executeQuery();
                 int Apositive = 0;
                 while(resultSet.next()){
                     Apositive = resultSet.getInt(1);
                 }
                    String sql3 = "select count(bloodgroup) as total from bloodbags where bloodgroup ='A' and bloodtype='+' and month(now()) and bloodstatus='no' ";
                  pstatement = connection.prepareStatement(sql3);
                 resultSet = pstatement.executeQuery();
                 int ApositiveRejected = 0;
                 while(resultSet.next()){
                     ApositiveRejected = resultSet.getInt(1);
                 }
                 
                 
                 
                                
               
                              String sql18 = "Select count(bloodgroup) as total from recipients where bloodgroup='A' and bloodtype='+ve' and month(now())";
               pstatement = connection.prepareStatement(sql18);
               resultSet = pstatement.executeQuery();
               int receivedApos = 0;
               while(resultSet.next()){
                   receivedApos = resultSet.getInt(1);
               }
               
                                 document.add(new Paragraph("              BAGS DONATED   "));
                                 PdfPTable table = new PdfPTable(5);
                                  table.setWidthPercentage(100);
                                 
                                 
                                   table.addCell("Blood Group");
                                 table.addCell("Available");
                               
                                 table.addCell("Rejected"); 
                                   table.addCell("Taken");
                                 table.addCell("Total");
                               //A Positive
                                 table.addCell("A+");
                                 
                                  table.addCell(""+Apositive);
                                 table.addCell(""+ApositiveRejected);
                                 table.addCell(""+receivedApos);
                                  int totalA = Apositive + ApositiveRejected + receivedApos;
                                 table.addCell(""+totalA);
                                 
                                 
                                 String sql4 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='A' and bloodtype='-ve' and month(now()) and bloodstatus='yes' "; 
                                  pstatement = connection.prepareStatement(sql4);
                 resultSet = pstatement.executeQuery();
                 int Anegative = 0;
                 while(resultSet.next()){
                     Anegative = resultSet.getInt(1);
                 }
                 String sql5 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='A' and bloodtype='-ve' and month(now()) and bloodstatus='no' "; 
                                 pstatement = connection.prepareStatement(sql5);
                 resultSet = pstatement.executeQuery();
                 int AnegativeRejected = 0;
                 while(resultSet.next()){
                     AnegativeRejected = resultSet.getInt(1);
                 }
                                String sql19 = "Select count(bloodgroup) as total from recipients where bloodgroup='A' and bloodtype='-ve' and month(now())";
               pstatement = connection.prepareStatement(sql19);
               resultSet = pstatement.executeQuery();
               int receivedAneg = 0;
               while(resultSet.next()){
                   receivedAneg = resultSet.getInt(1);
               }
                                 table.addCell("A-");
                                 table.addCell(""+Anegative);
                                 table.addCell(""+AnegativeRejected);
                                 table.addCell(""+ receivedAneg);
                                 int totalAneg = Anegative + AnegativeRejected + receivedAneg;
                                 table.addCell(""+totalAneg);
                                 
                                 //B positive
                                 
                                 table.addCell("B+");
                                 String sql6 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='B' and bloodtype='+ve' and month(now()) and bloodstatus='yes' "; 
                                 pstatement = connection.prepareStatement(sql6);
                 resultSet = pstatement.executeQuery();
                 int Bpositive = 0;
                 while(resultSet.next()){
                     Bpositive = resultSet.getInt(1);
                 }
                                String sql7 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='B' and bloodtype='+ve' and month(now()) and bloodstatus='no' "; 
                                 pstatement = connection.prepareStatement(sql7);
                 resultSet = pstatement.executeQuery();
                 int BpositiveRejected = 0;
                 while(resultSet.next()){
                     BpositiveRejected = resultSet.getInt(1);
                 }  
                                  String sql20 = "Select count(bloodgroup) as total from recipients where bloodgroup='B' and bloodtype='+ve' and month(now())";
               pstatement = connection.prepareStatement(sql20);
               resultSet = pstatement.executeQuery();
               int receivedBpos = 0;
               while(resultSet.next()){
                   receivedBpos = resultSet.getInt(1);
               }
                 
                 table.addCell(""+Bpositive);
                 table.addCell(""+BpositiveRejected);
                 table.addCell(""+ receivedBpos);
                 int totalBpos = Bpositive + BpositiveRejected+receivedBpos;
                 table.addCell(""+totalBpos);
                 
                 
                 
                 //B NEgative
                 table.addCell("B-");
                 
                                    String sql8 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='B' and bloodtype='-ve' and month(now()) and bloodstatus='yes' "; 
                                 pstatement = connection.prepareStatement(sql8);
                 resultSet = pstatement.executeQuery();
                 int Bnegative = 0;
                 while(resultSet.next()){
                     Bnegative = resultSet.getInt(1);
                 }
                                String sql9 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='B' and bloodtype='-ve' and month(now()) and bloodstatus='no' "; 
                                 pstatement = connection.prepareStatement(sql9);
                 resultSet = pstatement.executeQuery();
                 int BnegativeRejected = 0;
                 while(resultSet.next()){
                     BnegativeRejected = resultSet.getInt(1);
                 }  
                                  String sql21 = "Select count(bloodgroup) as total from recipients where bloodgroup='B' and bloodtype='-ve' and month(now())";
               pstatement = connection.prepareStatement(sql21);
               resultSet = pstatement.executeQuery();
               int receivedBneg = 0;
               while(resultSet.next()){
                   receivedBneg = resultSet.getInt(1);
               }
                 
                 int totalBneg =  Bnegative + BnegativeRejected + receivedBneg;
                 table.addCell(""+Bnegative);
                 table.addCell(""+ BnegativeRejected);
                 table.addCell(""+receivedBneg);
                 table.addCell("" +totalBneg);

                 
                 //AB Positive
                 
                                     String sql10 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='AB' and bloodtype='+ve' and month(now()) and bloodstatus='yes' "; 
                                 pstatement = connection.prepareStatement(sql10);
                 resultSet = pstatement.executeQuery();
                 int ABpositive = 0;
                 while(resultSet.next()){
                     ABpositive = resultSet.getInt(1);
                 }
                                String sql11 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='AB' and bloodtype='+ve' and month(now()) and bloodstatus='no' "; 
                                 pstatement = connection.prepareStatement(sql11);
                 resultSet = pstatement.executeQuery();
                 int ABpositiveRejected = 0;
                 while(resultSet.next()){
                     ABpositiveRejected = resultSet.getInt(1);
                 }             
                                 String sql22 = "Select count(bloodgroup) as total from recipients where bloodgroup='AB' and bloodtype='+ve' and month(now())";
               pstatement = connection.prepareStatement(sql22);
               resultSet = pstatement.executeQuery();
               int receivedABpos = 0;
               while(resultSet.next()){
                   receivedABpos = resultSet.getInt(1);
               }
                 int totalABpos = ABpositive + ABpositiveRejected +receivedABpos;
                 table.addCell("AB+");
                 table.addCell(""+ABpositive);
                 table.addCell(""+ABpositiveRejected);
                 table.addCell(""+receivedABpos);
                 table.addCell(""+totalABpos);
                 
                 //ABNegative
                 
                                     String sql12 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='AB' and bloodtype='-ve' and month(now()) and bloodstatus='yes' "; 
                                 pstatement = connection.prepareStatement(sql12);
                 resultSet = pstatement.executeQuery();
                 int ABnegative = 0;
                 while(resultSet.next()){
                     ABnegative = resultSet.getInt(1);
                 }
                                String sql13 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='AB' and bloodtype='-ve' and month(now()) and bloodstatus='no' "; 
                                 pstatement = connection.prepareStatement(sql13);
                 resultSet = pstatement.executeQuery();
                 int ABnegativeRejected = 0;
                 while(resultSet.next()){
                     ABnegativeRejected = resultSet.getInt(1);
                 } 
                                 String sql23 = "Select count(bloodgroup) as total from recipients where bloodgroup='AB' and bloodtype='-ve' and month(now())";
               pstatement = connection.prepareStatement(sql23);
               resultSet = pstatement.executeQuery();
               int receivedABneg = 0;
               while(resultSet.next()){
                   receivedABneg = resultSet.getInt(1);
               }
                 int totalABneg = ABnegative + ABnegativeRejected + receivedABneg;
                 table.addCell("AB-");
                 table.addCell(""+ABnegative);
                 table.addCell(""+ABnegativeRejected);
                 table.addCell(""+receivedABneg);
                 table.addCell(""+totalABneg);
                 
                 //O positive
                        String sql14 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='O' and bloodtype='+ve' and month(now()) and bloodstatus='yes' "; 
                                 pstatement = connection.prepareStatement(sql14);
                 resultSet = pstatement.executeQuery();
                 int Opositive = 0;
                 while(resultSet.next()){
                     Opositive= resultSet.getInt(1);
                 }
                                String sql15 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='O' and bloodtype='+ve' and month(now()) and bloodstatus='no' "; 
                                 pstatement = connection.prepareStatement(sql15);
                 resultSet = pstatement.executeQuery();
                 int OpositiveRejected= 0;
                 while(resultSet.next()){
                    OpositiveRejected = resultSet.getInt(1);
                 } 
                                 String sql24 = "Select count(bloodgroup) as total from recipients where bloodgroup='O' and bloodtype='+ve' and month(now())";
               pstatement = connection.prepareStatement(sql24);
               resultSet = pstatement.executeQuery();
               int receivedOpos = 0;
               while(resultSet.next()){
                   receivedOpos = resultSet.getInt(1);
               }
                 int totalOpos = Opositive + OpositiveRejected + receivedOpos;
                 table.addCell("O+");
                 table.addCell(""+Opositive);
                 table.addCell(""+OpositiveRejected);
                 table.addCell(""+ receivedOpos);
                 table.addCell(""+totalOpos);
                 
                  
                        String sql16 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='O' and bloodtype='-ve' and month(now()) and bloodstatus='yes' "; 
                                 pstatement = connection.prepareStatement(sql16);
                 resultSet = pstatement.executeQuery();
                 int Onegative = 0;
                 while(resultSet.next()){
                     Onegative= resultSet.getInt(1);
                 }
                                String sql17 ="select count(bloodgroup) as total from bloodbags where bloodgroup ='O' and bloodtype='-ve' and month(now()) and bloodstatus='no' "; 
                                 pstatement = connection.prepareStatement(sql17);
                 resultSet = pstatement.executeQuery();
                 int OnegativeRejected= 0;
                 while(resultSet.next()){
                    OnegativeRejected = resultSet.getInt(1);
                 } 
                                 String sql25 = "Select count(bloodgroup) as total from recipients where bloodgroup='O' and bloodtype='-ve' and month(now())";
               pstatement = connection.prepareStatement(sql25);
               resultSet = pstatement.executeQuery();
               int receivedOneg = 0;
               while(resultSet.next()){
                   receivedOneg = resultSet.getInt(1);
               }
                 int totalOneg = Onegative + OnegativeRejected + receivedOneg;
                 table.addCell("O-");
                 table.addCell(""+Onegative);
                 table.addCell(""+OnegativeRejected);
                 table.addCell(""+receivedOneg);
                 table.addCell(""+totalOneg);
                 int totalBags = totalA + totalAneg + totalBpos+totalBneg + totalABpos + totalABneg + totalOpos + totalOneg;
                 int totalAvailable = Apositive + Anegative + Bpositive + Bnegative + ABpositive + ABnegative + Opositive + Onegative;
                 int totalRejected = ApositiveRejected + AnegativeRejected + BpositiveRejected + BnegativeRejected + ABpositiveRejected + ABnegativeRejected + OpositiveRejected+ OnegativeRejected;
                 table.addCell("TOTAL");
                 table.addCell(""+ totalAvailable );
                 table.addCell(""+totalRejected);
                 int totalTaken = receivedApos + receivedAneg + receivedBpos + receivedBneg +receivedABpos +receivedABneg+receivedOpos +receivedOneg;
                 table.addCell(""+totalTaken);
                 table.addCell(""+totalBags);
                 
                                 document.add(table);
                                 //END OF TABLE
                                 
               //RECEIVED BAGS TABLE
               PdfPTable recipientTable = new PdfPTable(8);
               document.add(new Paragraph("                    BAGS RECEIVED BY COUNTY HOSPITALS   "));
               recipientTable.setWidthPercentage(100);
               recipientTable.addCell("Hospital");
                recipientTable.addCell("County Referral Hospital");
                 recipientTable.addCell("North Sub County Hospital");
                recipientTable.addCell("South Sub County Hospital");
                recipientTable.addCell("Central Sub county Hospital");
                recipientTable.addCell("East Sub County Hospital");
                recipientTable.addCell("West Sub County Hospital");
                 recipientTable.addCell("Total ");
                recipientTable.addCell("Bags ");
                
                
                String sql26 = " Select count(hospital) as total from recipients where hospital = 'County Referral Hospital' and month(now()) " ;
                pstatement = connection.prepareStatement(sql26);
                resultSet = pstatement.executeQuery();
                int referral = 0;
                while (resultSet.next()){
                    referral = resultSet.getInt(1);
                }
                
                
                recipientTable.addCell(""+referral);
                
                 String sql27 = " Select count(hospital) as total from recipients where hospital = 'North Sub-County Hospital' and month(now()) " ;
                pstatement = connection.prepareStatement(sql27);
                resultSet = pstatement.executeQuery();
                int north = 0;
                while (resultSet.next()){
                    north = resultSet.getInt(1);
                }
                recipientTable.addCell(""+north);
                
                  String sql28 = " Select count(hospital) as total from recipients where hospital = 'South Sub-County Hospital' and month(now()) " ;
                pstatement = connection.prepareStatement(sql28);
                resultSet = pstatement.executeQuery();
                int south = 0;
                while (resultSet.next()){
                    south = resultSet.getInt(1);
                }
                recipientTable.addCell(""+south);
                
                                  String sql29 = " Select count(hospital) as total from recipients where hospital = 'Central Sub-county Hospital' and month(now()) " ;
                pstatement = connection.prepareStatement(sql29);
                resultSet = pstatement.executeQuery();
                int central = 0;
                while (resultSet.next()){
                    central = resultSet.getInt(1);
                }
               recipientTable.addCell(""+central);
                                 String sql30 = " Select count(hospital) as total from recipients where hospital = 'East Sub-county Hospital' and month(now()) " ;
                pstatement = connection.prepareStatement(sql30);
                resultSet = pstatement.executeQuery();
                int east = 0;
                while (resultSet.next()){
                    east = resultSet.getInt(1);
                }
                recipientTable.addCell(""+east);
                
                                String sql31 = " Select count(hospital) as total from recipients where hospital = 'West Sub-County Hospital' and month(now()) " ;
                pstatement = connection.prepareStatement(sql31);
                resultSet = pstatement.executeQuery();
                int west = 0;
                while (resultSet.next()){
                    west = resultSet.getInt(1);
                }
                                recipientTable.addCell(""+west);
                            int totalHos = west + central + east + north  + south + referral;
                            recipientTable.addCell(""+totalHos);
                   
                                
               document.add(recipientTable);

               
               
                
                document.addCreationDate();
                document.close();
            %>
    </body>
</html>
 